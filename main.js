(()=>{"use strict";function t(t){t.classList.add("popup_is-animated"),t.classList.add("popup_is-opened"),t.addEventListener("click",o),document.addEventListener("keydown",e)}function e(t){"Escape"===t.key&&n(document.querySelector(".popup_is-opened"))}function o(t){var e=document.querySelector(".popup_is-opened").querySelector(".popup__close");t.target!==t.currentTarget&&t.target!==e||n(document.querySelector(".popup_is-opened"))}function n(t){t.classList.remove("popup_is-opened"),t.removeEventListener("click",o),document.removeEventListener("keydown",e)}var r=".popup__input",c=".popup__button",a="popup__button_disabled",i="popup__input_type_error",u="popup__error_visible",d=function(t,e){var o=t.querySelector(".".concat(e.id,"-error"));e.classList.remove(i),o.classList.remove(u),o.textContent=""},l=function(t,e){!function(t){return t.some((function(t){return!t.validity.valid}))}(t)?(e.disabled=!1,e.classList.remove(a)):(e.disabled=!0,e.classList.add(a))},s=function(t){var e=Array.from(t.querySelectorAll(r)),o=t.querySelector(c);e.forEach((function(e){d(t,e),e.setCustomValidity("")})),o.disabled=!0,o.classList.add(a)},p=document.querySelector("#card-template").content;function _(e,o){var n=p.querySelector(".places__item").cloneNode(!0),r=n.querySelector(".card__image"),c=n.querySelector(".card__title"),a=p.querySelector(".card__likes-amount");return r.src=e.link,r.alt=e.name,c.textContent=e.name,a.textContent=o,r.addEventListener("click",(function(){var o,n;o=e.name,n=e.link,A.src=n,A.alt=o,C.textContent=o,t(E)})),n}var f="https://nomoreparties.co/v1/wff-cohort-2",m=document.querySelector(".places__list"),y=function(t){t.target.classList.toggle("card__like-button_is-active"),t.target.classList.contains("card__like-button_is-active")?fetch("https://nomoreparties.co/v1/wff-cohort-2/cards/likes/".concat(t.target.getAttribute("data-like-card-id")),{method:"PUT",headers:{authorization:"69f8653c-9291-433e-9bb1-872dc49ab260","Content-Type":"application/json"}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).then((function(e){document.getElementById("".concat(t.target.getAttribute("data-like-card-id"))).querySelector(".card__likes-amount").textContent=e.likes.length})).catch((function(t){console.log("Ошибка. Запрос не выполнен: "+t)})):fetch("https://nomoreparties.co/v1/wff-cohort-2/cards/likes/".concat(t.target.getAttribute("data-like-card-id")),{method:"DELETE",headers:{authorization:"69f8653c-9291-433e-9bb1-872dc49ab260","Content-Type":"application/json"}}).then((function(t){return t.json()})).then((function(e){document.getElementById("".concat(t.target.getAttribute("data-like-card-id"))).querySelector(".card__likes-amount").textContent=e.likes.length})).catch((function(t){console.log("Ошибка. Запрос не выполнен: "+t)}))},b=document.querySelector(".profile__title"),h=document.querySelector(".profile__description"),v=(document.querySelector(".profile__image"),document.querySelector(".profile__edit-button")),S=document.querySelector(".popup_type_edit"),q=S.querySelector(".popup__close"),g=document.querySelector(".profile__add-button"),k=document.querySelector(".popup_type_new-card"),L=k.querySelector(".popup__close"),E=document.querySelector(".popup_type_image"),A=document.querySelector(".popup__image"),C=document.querySelector(".popup__caption"),j=E.querySelector(".popup__close"),x=document.querySelector(".popup_type_delete"),T=x.querySelector(".popup__button"),w=S.querySelector(".popup__button"),P=k.querySelector(".popup__form"),z=S.querySelector(".popup__form"),D=document.querySelector(".popup__input_type_card-name"),N=document.querySelector(".popup__input_type_url"),O=document.querySelector(".popup__input_type_name"),B=document.querySelector(".popup__input_type_description"),I=document.querySelector(".profile__image_edit-button"),J=document.querySelector(".popup_type_edit_avatar"),M=J.querySelector(".popup__button"),V=J.querySelector(".popup__form");v.addEventListener("click",(function(){t(S),O.value=b.textContent,B.value=h.textContent,s(z)})),g.addEventListener("click",(function(){t(k),D.value="",N.value="",s(P)})),q.addEventListener("click",(function(){n(S)})),L.addEventListener("click",(function(){n(k)})),j.addEventListener("click",(function(){n(E)})),Array.from(document.querySelectorAll(".popup__form")).forEach((function(t){!function(t){var e=Array.from(t.querySelectorAll(r)),o=t.querySelector(c);l(e,o),e.forEach((function(n){n.addEventListener("input",(function(){(function(t,e){e.validity.patternMismatch?e.setCustomValidity(e.dataset.errorMessage):e.setCustomValidity(""),e.validity.valid?d(t,e):function(t,e,o){var n=t.querySelector(".".concat(e.id,"-error"));e.classList.add(i),n.classList.add(u),n.textContent=o}(t,e,e.validationMessage)})(t,n),l(e,o)}))}))}(t)})),fetch("".concat(f,"/users/me"),{headers:{authorization:"69f8653c-9291-433e-9bb1-872dc49ab260"}}).then((function(t){return t.json()})).then((function(t){document.querySelector(".profile__title").textContent=t.name,document.querySelector(".profile__description").textContent=t.about,document.querySelector(".profile__image").setAttribute("style","background-image: url(".concat(t.avatar,");"))})).catch((function(t){console.log("Ошибка. Запрос не выполнен: ",t)})),Promise.all([fetch("".concat(f,"/users/me"),{headers:{authorization:"69f8653c-9291-433e-9bb1-872dc49ab260"}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).then((function(t){return t._id})).catch((function(t){console.log("Ошибка. Запрос не выполнен: ",t)})),fetch("https://nomoreparties.co/v1/wff-cohort-2/cards",{headers:{authorization:"69f8653c-9291-433e-9bb1-872dc49ab260"}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).then((function(t){return t})).catch((function(t){console.log("Ошибка. Запрос не выполнен: ",t)}))]).then((function(t){var e=t[1],o=t[0];e.forEach((function(t){var e=_(t,t.likes.length),n=e.querySelector(".card__delete-button"),r=e.querySelector(".card__like-button"),c=e.querySelector(".card__likes-amount");e.setAttribute("id",t._id),n.setAttribute("data-button-id",t._id),r.setAttribute("data-like-card-id",t._id),r.addEventListener("click",(function(t){y(t)})),c.textContent=t.likes.length,t.owner._id!==o&&(n.style.display="none"),t.likes.some((function(t){return t._id===o}))&&r.classList.add("card__like-button_is-active"),m.append(e)}))})).then((function(){document.querySelectorAll(".card__delete-button").forEach((function(e){e.addEventListener("click",(function(e){var o=document.querySelector(".popup_type_delete");t(o),o.querySelector(".popup__button").setAttribute("data-id",e.target.getAttribute("data-button-id"))}))}))})),T.addEventListener("click",(function(t){!function(t){fetch("https://nomoreparties.co/v1/wff-cohort-2/cards/".concat(t.target.getAttribute("data-id")),{method:"DELETE",headers:{authorization:"69f8653c-9291-433e-9bb1-872dc49ab260","Content-Type":"application/json"}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).then((function(){document.getElementById("".concat(t.target.getAttribute("data-id"))).remove()})).catch((function(t){console.log("Ошибка. Запрос не выполнен: "+t)}))}(t),n(x)})),z.addEventListener("submit",(function(t){var e;t.preventDefault(),w.textContent=w.getAttribute("data-loading"),e={name:O.value,about:B.value},fetch("https://nomoreparties.co/v1/wff-cohort-2/users/me",{method:"PATCH",body:JSON.stringify({name:e.name,about:e.about}),headers:{authorization:"69f8653c-9291-433e-9bb1-872dc49ab260","Content-Type":"application/json"}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).then((function(t){document.querySelector(".profile__title").textContent=t.name,document.querySelector(".profile__description").textContent=t.about})).catch((function(t){console.log("Ошибка. Запрос не выполнен: "+t)})).finally((function(){var t=document.querySelector(".popup_type_edit").querySelector(".popup__button");t.textContent=t.getAttribute("data-default-text")})),n(S)})),document.forms.newPlace.addEventListener("submit",(function(e){e.preventDefault();var o,r=e.currentTarget.elements,c=r.placeName,a=r.link;o={name:c.value,link:a.value},fetch("https://nomoreparties.co/v1/wff-cohort-2/cards",{method:"POST",body:JSON.stringify({name:o.name,link:o.link}),headers:{authorization:"69f8653c-9291-433e-9bb1-872dc49ab260","Content-Type":"application/json"}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).then((function(e){var o=_(e,e.likes.length),n=o.querySelector(".card__delete-button"),r=o.querySelector(".card__like-button"),c=o.querySelector(".card__likes-amount");o.setAttribute("id",e._id),n.setAttribute("data-button-id",e._id),r.setAttribute("data-like-card-id",e._id),n.addEventListener("click",(function(e){var o=document.querySelector(".popup_type_delete");t(o),o.querySelector(".popup__button").setAttribute("data-id",e.target.getAttribute("data-button-id"))})),r.addEventListener("click",(function(t){y(t)})),c.textContent=e.likes.length,e.likes.some((function(t){return"fd8130cfa77dd3af30b582d8"===t._id}))&&r.classList.add("card__like-button_is-active"),m.prepend(o)})).catch((function(t){console.log("Ошибка. Запрос не выполнен: "+t)})),D.value="",N.value="",n(k)})),I.addEventListener("click",(function(){t(J),s(V)})),M.addEventListener("click",(function(t){t.preventDefault(),M.textContent=M.getAttribute("data-loading");var e,o=J.querySelector(".popup__input");e=o.value,fetch("https://nomoreparties.co/v1/wff-cohort-2/users/me/avatar",{method:"PATCH",body:JSON.stringify({avatar:e}),headers:{authorization:"69f8653c-9291-433e-9bb1-872dc49ab260","Content-Type":"application/json"}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).then((function(t){document.querySelector(".profile__image").setAttribute("style","background-image: url(".concat(e,");"))})).catch((function(t){console.log("Ошибка. Запрос не выполнен: ",t)})).finally((function(){var t=document.querySelector(".popup_type_edit_avatar").querySelector(".popup__button");t.textContent=t.getAttribute("data-default-text")})),o.value="",n(J)}))})();